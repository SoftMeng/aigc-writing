#!/usr/bin/env python3
"""
批量生成第53章角色战斗图片 - 使用命令行方式
"""

import os
import subprocess
from pathlib import Path

# 第53章角色战斗提示词（精简版）
characters = {
    "卡芙卡": """竖图战斗场景。卡芙卡以极具侵略性的战斗姿态立于画面中央，身体微微前倾形成蓄势待发的压迫感。她单手握持改造后的能量冲锋枪，枪身散发着幽紫色光芒，枪管上刻有复杂的星穹铁道符文。眼神半眯着闪烁玩味光芒，嘴角微微上扬勾勒慵懒危险笑容。紫黑色睫毛微微颤动，额前几缕发丝被能量场吹起。黑色短外套微微敞开露出白色丝绸衬衫，黑色腿袜边缘紫色条纹在战斗中发光。采用伦勃朗光效，左侧脸庞处于阴影中，右侧被紫色光芒照亮。电影级低角度仰拍增强压迫感。""",

    "希儿": """竖图战斗场景。希儿以灵动飘逸的战斗姿态呈现，身体轻盈悬空约30厘米，双腿微曲呈备战姿态。粉色短发在能量场中根根分明向上飞扬。双手紧握巨大的量子镰刀，刀身由粉色能量构成，刀刃长达150厘米呈不规则晶体结构。镰刀挥动时周围空间扭曲形成粉色涟漪。眼睛睁得大大的闪烁坚定决心，嘴角微微上扬露出战斗中的兴奋。白色连衣裙猎猎作响，裙摆被能量场吹起。梦幻柔光效果，电影级中景仰拍捕捉动感与优雅。""",

    "符玄": """竖图战斗场景。符玄以端庄威严的战斗姿态呈现，身体挺拔如松，右手举起法器指向斜上方45度，左手掐诀置于胸前。白色长发在能量场中缓缓飘动。双手托举巨大的白玉法器，呈八角形，每角镶嵌不同颜色宝石，周围环绕旋转的金色星砂。眼睛微微闭着闪烁智慧光芒，嘴角微微上扬露出慈悲微笑。白色长袍无风自动。神圣光效从上方倾泻而下。电影级正面平视展现神圣气质。""",

    "阿卡丽": """竖图战斗场景。阿卡丽以极速突袭的战斗姿态呈现，身体微微下蹲形成蓄势待发姿态。右手紧握苦无准备投掷，黑色长发在身后如瀑布般散开。苦无由特殊合金打造，刃长18厘米呈十字形，表面刻有古老忍者符文吸收暗影能量。眼睛微微眯起闪烁冰冷杀意，嘴角紧抿成直线没有任何感情色彩。黑色战斗服完美勾勒矫健身姿。暗影光效，角色处于半明半暗光影交界处。电影级低角度仰拍增强速度感与力量感。""",

    "卡莎": """竖图战斗场景。卡莎以火力全开的战斗姿态呈现，身体微微后仰形成开枪后坐力姿态。双手紧握机枪呈射击姿态，紫色短发在虚空能量中根根倒竖。机枪由虚空科技打造，枪身长约120厘米呈流线型，枪管刻有虚空符文有多个能量核心散发出强烈紫色光芒。眼睛睁得极大闪烁疯狂光芒，嘴角大大上扬露出狂野笑容。紫色紧身战斗服完美贴合身体。虚空光效，强烈紫色光芒照亮角色。电影级正面平视展现火力全开姿态。""",

    "金克丝": """竖图战斗场景。金克丝以极度疯狂的战斗姿态呈现，身体扭曲形成夸张S曲线。单手叉腰另一只手扛巨大火箭筒，蓝色马尾辫在身后高高扬起。火箭筒由废弃金属拼凑而成，筒身涂装蓝粉相间迷彩，发射时形成蓝色火焰尾迹。眼睛睁得极大闪烁疯狂光芒，嘴角大大咧开笑容夸张扭曲。蓝色战斗服有多处破损与烧焦痕迹。爆炸光效，火箭筒发射时的尾焰照亮角色。电影级低角度仰拍增强疯狂感与压迫感。""",

    "优香": """竖图战斗场景。优香以半跪姿态进行狙击，右膝跪地左腿在前支撑。身体微微前倾形成稳定狙击姿态，双手托举狙击步枪眼睛贴在瞄准镜上。金色长发束成马尾垂落在背后。狙击步枪采用高精度材质，枪身长约150厘米，枪管有金属光泽，瞄准镜为高倍率光学镜筒。眼睛微微眯起锁定目标，眉头轻锁显示专注与谨慎。嘴角微微抿紧有令人安心的坚定。白色战斗外套略显专业感。冷冽光效，瞄准镜反光照亮面部。电影级侧面45度角展现狙击姿态。""",

    "星野": """竖图战斗场景。星野以极其慵懒却充满力量的战斗姿态呈现，身体微微后仰单手叉腰，另一只手随意举着散弹枪。散弹枪经过个性改造，枪身长约90厘米呈流线型，枪管双管设计散射范围广。枪身涂装粉色有白色星形图案。眼睛半睁着闪烁慵懒光芒，嘴角微微上扬露漫不经心微笑。粉色连衣裙在战斗中轻轻飘动。温柔光效，枪口光芒照亮角色。电影级正面平视展现慵懒姿态。""",

    "爱丽丝": """竖图战斗场景。爱丽丝以极其可爱的战斗姿态呈现，身体轻轻扭转形成优美S曲线。双手背在身后看似无害却握紧冲锋枪。白色短发在能量场中微微飘动。冲锋枪融合童话元素，枪身长约70厘米设计如童话魔法棒，枪管水晶材质透明发光有蕾丝装饰。眼睛睁得大大的闪烁纯真光芒，嘴角大大上扬露灿烂笑容如天使般纯洁。白色连衣裙在战斗中轻轻飘动。梦幻光效，冲锋枪光芒照亮角色。电影级正面平视展现可爱表情。""",

    "珂蕾妲": """竖图战斗场景。珂蕾妲以极其霸气的战斗姿态呈现，身体微微后仰形成劈砍蓄势姿态。右手紧握大剑高举过头顶，红色长发在身后如火焰般飞扬。大剑由烈焰与钢铁打造，剑身长约180厘米宽30厘米，表面有龙鳞纹理。剑身涂装血红色有金色纹路，挥舞时周围有火焰环绕。眼睛睁得大大闪烁狂野光芒，眉头紧锁形成锐利折线，嘴角微微上扬露冷酷笑容。红色战斗外套在火焰中猎猎作响。烈焰光效，大剑挥舞时的火焰照亮角色。电影级低角度仰拍增强霸气感与力量感。""",

    "安比": """竖图战斗场景。安比以极其冷静的战斗姿态呈现，身体微微下蹲形成潜伏猎豹姿态。右手反握匕首置于身后准备突袭，紫色短发在阴影中微微飘动。匕首由虚空科技与古老锻造术结合，全长约40厘米刃长25厘米呈优雅弧线形。刀刃表面有紫色幽光涂层能在黑暗中隐形。眼睛微微眯起闪烁冰冷光芒，嘴角紧抿成直线没有任何表情。紫色战斗服完美贴合身体。阴影光效，匕首光芒从侧面照亮角色。电影级侧面45度角展现冷静姿态。"""
}

def main():
    """批量生成战斗图片"""

    script_path = "/Users/xiangyuanmeng/Documents/TowerProject2/aigc-writing/.claude/skills/comfyui-image-generation/scripts/generate.py"
    output_dir = "/Users/xiangyuanmeng/Documents/TowerProject2/aigc-writing/我逛漫展的那些年/插图/第053章"

    print(f"开始生成第53章角色战斗图片...")
    print(f"输出目录: {output_dir}")
    print(f"角色数量: {len(characters)}")
    print("-" * 60)

    # 确保输出目录存在
    os.makedirs(output_dir, exist_ok=True)

    success_count = 0
    failed_count = 0

    for i, (name, prompt) in enumerate(characters.items()):
        try:
            print(f"\n[{i+1}/{len(characters)}] 正在生成 {name} 的战斗图片...")

            # 构建命令
            cmd = [
                "python3", str(script_path),
                "--width", "768",
                "--height", "1536",  # 竖图格式
                "--steps", "20",
                "--sampler", "er_sde",
                "--scheduler", "normal",
                "--lora", "nsfw_v1.safetensors",
                "--lora_weight", "0.8",
                "--output_dir", output_dir,
                "--server", "localhost:8188",
                "--prefix", f"第053章_{name}_战斗",
                prompt
            ]

            # 执行命令
            result = subprocess.run(cmd, capture_output=True, text=True, timeout=300)

            if result.returncode == 0:
                print(f"  成功生成!")
                print(f"  输出: {result.stdout}")
                success_count += 1
            else:
                print(f"  错误: {result.stderr}")
                failed_count += 1

        except subprocess.TimeoutExpired:
            print(f"  错误: 生成超时")
            failed_count += 1
        except Exception as e:
            print(f"  错误: {e}")
            failed_count += 1

    print("\n" + "=" * 60)
    print(f"生成完成！成功: {success_count}, 失败: {failed_count}")
    print("=" * 60)

if __name__ == "__main__":
    main()
